{{ 'win98-media-duo.css' | asset_url | stylesheet_tag }}
{{ 'component-modal-video.css' | asset_url | stylesheet_tag }}
{{ 'component-deferred-media.css' | asset_url | stylesheet_tag }}

{%- style -%}
  .section-{{ section.id }}-padding {
    padding-top: {{ section.settings.padding_top | times: 0.75 | round: 0 }}px;
    padding-bottom: {{ section.settings.padding_bottom | times: 0.75 | round: 0 }}px;
  }

  @media screen and (min-width: 750px) {
    .section-{{ section.id }}-padding {
      padding-top: {{ section.settings.padding_top }}px;
      padding-bottom: {{ section.settings.padding_bottom }}px;
    }
  }

  /* Individual block media height controls with max height of 800px */
  {%- for block in section.blocks -%}
    {% case block.settings.image_height %}
      {% when 'small' %}
        [data-block-id="{{ block.id }}"] .media-duo__media .media {
          height: 200px !important;
        }
        [data-block-id="{{ block.id }}"] .media-duo__media .media img,
        [data-block-id="{{ block.id }}"] .media-duo__media .media video {
          object-fit: cover !important;
        }
      {% when 'medium' %}
        [data-block-id="{{ block.id }}"] .media-duo__media .media {
          height: 300px !important;
        }
        [data-block-id="{{ block.id }}"] .media-duo__media .media img,
        [data-block-id="{{ block.id }}"] .media-duo__media .media video {
          object-fit: cover !important;
        }
      {% when 'large' %}
        [data-block-id="{{ block.id }}"] .media-duo__media .media {
          height: 400px !important;
        }
        [data-block-id="{{ block.id }}"] .media-duo__media .media img,
        [data-block-id="{{ block.id }}"] .media-duo__media .media video {
          object-fit: cover !important;
        }
      {% when 'extra_large' %}
        [data-block-id="{{ block.id }}"] .media-duo__media .media {
          height: 500px !important;
        }
        [data-block-id="{{ block.id }}"] .media-duo__media .media img,
        [data-block-id="{{ block.id }}"] .media-duo__media .media video {
          object-fit: cover !important;
        }
      {% when 'adapt' %}
        [data-block-id="{{ block.id }}"] .media-duo__media .media {
          height: auto !important;
          max-height: 800px !important;
          max-width: none !important;
        }
        [data-block-id="{{ block.id }}"] .media-duo__media .media img,
        [data-block-id="{{ block.id }}"] .media-duo__media .media video {
          width: 100% !important;
          height: auto !important;
          object-fit: contain !important;
          max-width: none !important;
        }
      {% else %}
        /* Default medium height if no setting is specified */
        [data-block-id="{{ block.id }}"] .media-duo__media .media {
          height: 300px !important;
        }
        [data-block-id="{{ block.id }}"] .media-duo__media .media img,
        [data-block-id="{{ block.id }}"] .media-duo__media .media video {
          object-fit: cover !important;
        }
    {% endcase %}
  {%- endfor -%}

  /* Enforce max height on all media containers */
  .section-{{ section.id }}-padding .media-duo__media .media {
    max-height: 800px !important;
  }

  /* Spacing between items */
  .section-{{ section.id }}-padding .media-duo {
    gap: {{ section.settings.media_spacing }}px !important;
  }

  /* Image size controls - only apply when not adapting to image ratio */
  {% case section.settings.image_size %}
    {% when 'small' %}
      .section-{{ section.id }}-padding .media-duo__media .media:not([data-adapt]) {
        max-width: 250px !important;
        margin: 0 auto !important;
      }
    {% when 'medium' %}
      .section-{{ section.id }}-padding .media-duo__media .media:not([data-adapt]) {
        max-width: 400px !important;
        margin: 0 auto !important;
      }
    {% when 'large' %}
      .section-{{ section.id }}-padding .media-duo__media .media:not([data-adapt]) {
        max-width: 600px !important;
        margin: 0 auto !important;
      }
    {% when 'full' %}
      .section-{{ section.id }}-padding .media-duo__media .media {
        max-width: 100% !important;
        margin: 0 !important;
      }
      .section-{{ section.id }}-padding .media-duo__media {
        margin: 0 !important;
        padding: 0 !important;
      }
      .section-{{ section.id }}-padding .window-body {
        padding: 0 !important;
      }
    {% else %}
      /* Default fallback - medium size */
      .section-{{ section.id }}-padding .media-duo__media .media:not([data-adapt]) {
        max-width: 400px !important;
        margin: 0 auto !important;
      }
  {% endcase %}

  /* Allow adapt blocks to use full container width */
  .section-{{ section.id }}-padding .media-duo__media .media[data-adapt] {
    max-width: 100% !important;
    margin: 0 !important;
  }
{%- endstyle -%}

<div class="color-{{ section.settings.color_scheme }} gradient isolate">
  <div class="page-width section-{{ section.id }}-padding">
    {%- if section.settings.heading != blank -%}
      <h2 class="media-duo-wrapper-title inline-richtext {{ section.settings.heading_size }}{% if settings.animations_reveal_on_scroll %} scroll-trigger animate--slide-in{% endif %}">
        {{ section.settings.heading }}
      </h2>
    {%- endif -%}
    
    <div class="media-duo{% if section.settings.mobile_layout == 'stack' %} media-duo--mobile-stack{% endif %}">
      {%- for block in section.blocks -%}
        <div
          class="media-duo__item media-duo__item--{{ block.type }}{% if settings.animations_reveal_on_scroll %} scroll-trigger animate--slide-in{% endif %}"
          data-block-id="{{ block.id }}"
          {{ block.shopify_attributes }}
          {% if settings.animations_reveal_on_scroll %}
            data-cascade
            style="--animation-order: {{ forloop.index }};"
          {% endif %}
        >
          {%- if block.settings.block_link != blank -%}
            <a href="{{ block.settings.block_link }}" class="media-duo__block-link">
          {%- endif -%}
          <div class="window">
            <div class="window-body">
            {%- case block.type -%}
              {%- when 'image' -%}
                <div class="media-duo__media">
                  {%- if block.settings.image != blank -%}
                    <div
                      class="media media--transparent"
                      {% if block.settings.image_height == 'adapt' %}data-adapt{% endif %}
                      {% if block.settings.image != blank %}
                        style="--ratio-percent: {{ 1 | divided_by: block.settings.image.aspect_ratio | times: 100 }}%"
                      {% else %}
                        style="--ratio-percent: 100%"
                      {% endif %}
                    >
                      {{
                        block.settings.image
                        | image_url: width: 1600
                        | image_tag:
                          sizes: '(min-width: 990px) 50vw, 100vw',
                          widths: '200, 300, 400, 500, 600, 700, 800, 900, 1000, 1200, 1400, 1600'
                      }}
                    </div>
                  {%- else -%}
                    <div class="media media--placeholder">
                      {{ 'detailed-apparel-1' | placeholder_svg_tag: 'placeholder-svg' }}
                    </div>
                  {%- endif -%}
                </div>

              {%- when 'video' -%}
                <div class="media-duo__media">
                  <modal-opener data-modal="#PopupModal-{{ block.id }}">
                    <div class="deferred-media">
                      <button
                        class="deferred-media__poster full-unstyled-link"
                        type="button"
                        aria-label="{{ 'sections.video.load_video' | t: description: block.settings.description | escape }}"
                        aria-haspopup="dialog"
                        data-media-id="{{ block.settings.video_url.id }}"
                      >
                        <div
                          class="media media--transparent"
                          {% if block.settings.image_height == 'adapt' %}data-adapt{% endif %}
                          {% if block.settings.cover_image != blank %}
                            style="--ratio-percent: {{ 1 | divided_by: block.settings.cover_image.aspect_ratio | times: 100 }}%"
                          {% else %}
                            style="--ratio-percent: 100%"
                          {% endif %}
                        >
                          <span class="deferred-media__poster-button motion-reduce">
                            <span class="svg-wrapper">
                              {{- 'icon-play.svg' | inline_asset_content -}}
                            </span>
                          </span>

                          {%- if block.settings.cover_image != blank -%}
                            {{
                              block.settings.cover_image
                              | image_url: width: 1600
                              | image_tag: sizes: '(min-width: 990px) 50vw, 100vw', widths: '400, 500, 600, 700, 800, 900, 1000, 1200, 1400, 1600'
                            }}
                          {%- else -%}
                            {{ 'hero-apparel-3' | placeholder_svg_tag: 'placeholder-svg placeholder' }}
                          {%- endif -%}
                        </div>
                      </button>
                    </div>
                  </modal-opener>
                  <modal-dialog
                    id="PopupModal-{{ block.id }}"
                    class="modal-video media-modal color-{{ settings.color_schemes | first }}"
                  >
                    <div
                      class="modal-video__content"
                      role="dialog"
                      aria-label="{{ block.settings.description | escape }}"
                      aria-modal="true"
                      tabindex="-1"
                    >
                      <button
                        id="ModalClose-{{ block.id }}"
                        type="button"
                        class="modal-video__toggle"
                        aria-label="{{ 'accessibility.close' | t }}"
                      >
                        <span class="svg-wrapper">
                          {{- 'icon-close.svg' | inline_asset_content -}}
                        </span>
                      </button>
                      <div class="modal-video__content-info">
                        <deferred-media class="modal-video__video template-popup">
                          <template>
                            {%- if block.settings.video_url.type == 'youtube' -%}
                              <iframe
                                src="https://www.youtube.com/embed/{{ block.settings.video_url.id }}?enablejsapi=1"
                                class="js-youtube"
                                allow="autoplay; encrypted-media"
                                allowfullscreen
                                title="{{ block.settings.description | escape }}"
                              ></iframe>
                            {%- else -%}
                              <iframe
                                src="https://player.vimeo.com/video/{{ block.settings.video_url.id }}"
                                class="js-vimeo"
                                allow="autoplay; encrypted-media"
                                allowfullscreen
                                title="{{ block.settings.description | escape }}"
                              ></iframe>
                            {%- endif -%}
                          </template>
                        </deferred-media>
                      </div>
                    </div>
                  </modal-dialog>
                </div>
            {%- endcase -%}
            
            {%- if block.settings.heading != blank or block.settings.text != blank or block.settings.button_label != blank -%}
              <div class="media-duo__content{% if block.settings.center_content %} media-duo__content--center{% endif %}">
                {%- if block.settings.heading != blank -%}
                  <h3 class="media-duo__heading">{{ block.settings.heading }}</h3>
                {%- endif -%}
                {%- if block.settings.text != blank -%}
                  <div class="media-duo__text rte">{{ block.settings.text }}</div>
                {%- endif -%}
                {%- if block.settings.button_label != blank and block.settings.button_link != blank -%}
                  <button type="button" onclick="window.open('{{ block.settings.button_link }}', '_blank')">
                    {{ block.settings.button_label | escape }}
                  </button>
                {%- endif -%}
              </div>
            {%- endif -%}
            </div>
          </div>
          {%- if block.settings.block_link != blank -%}
            </a>
          {%- endif -%}
        </div>
      {%- endfor -%}
    </div>
  </div>
</div>

{% schema %}
{
  "name": "Win98 Media Duo v2",
  "tag": "section",
  "class": "section",
  "disabled_on": {
    "groups": ["header", "footer"]
  },
  "settings": [
    {
      "type": "inline_richtext",
      "id": "heading",
      "default": "Media Duo",
      "label": "Heading"
    },
    {
      "type": "select",
      "id": "heading_size",
      "options": [
        {
          "value": "h2",
          "label": "Small"
        },
        {
          "value": "h1",
          "label": "Medium"
        },
        {
          "value": "h0",
          "label": "Large"
        },
        {
          "value": "hxl",
          "label": "Extra large"
        },
        {
          "value": "hxxl",
          "label": "XX-Large"
        }
      ],
      "default": "h1",
      "label": "Heading size"
    },
    {
      "type": "header",
      "content": "Layout Controls"
    },
    {
      "type": "select",
      "id": "mobile_layout",
      "options": [
        {
          "value": "side-by-side",
          "label": "Side by side"
        },
        {
          "value": "stack",
          "label": "Stack"
        }
      ],
      "default": "stack",
      "label": "Mobile layout"
    },
    {
      "type": "range",
      "id": "media_spacing",
      "min": 0,
      "max": 50,
      "step": 5,
      "default": 20,
      "unit": "px",
      "label": "Spacing between items",
      "info": "Adjust the gap between media items"
    },
    {
      "type": "select",
      "id": "image_size",
      "options": [
        {
          "value": "small",
          "label": "Small (250px)"
        },
        {
          "value": "medium",
          "label": "Medium (400px)"
        },
        {
          "value": "large",
          "label": "Large (600px)"
        },
        {
          "value": "full",
          "label": "Full width"
        }
      ],
      "default": "medium",
      "label": "Image size",
      "info": "Control the maximum width of images"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Color scheme",
      "default": "scheme-1"
    },
    {
      "type": "header",
      "content": "Section padding"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Top padding",
      "default": 36
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Bottom padding",
      "default": 36
    }
  ],
  "blocks": [
    {
      "type": "image",
      "name": "Image",
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image"
        },
        {
          "type": "select",
          "id": "image_height",
          "label": "Image height",
          "options": [
            {
              "value": "adapt",
              "label": "Adapt to image ratio"
            },
            {
              "value": "small",
              "label": "Small (200px)"
            },
            {
              "value": "medium",
              "label": "Medium (300px)"
            },
            {
              "value": "large",
              "label": "Large (400px)"
            },
            {
              "value": "extra_large",
              "label": "Extra Large (500px)"
            }
          ],
          "default": "adapt",
          "info": "Control how the image is displayed. Max height is always 800px."
        },
        {
          "type": "url",
          "id": "block_link",
          "label": "Block link",
          "info": "Make the entire block clickable"
        },
        {
          "type": "header",
          "content": "Content"
        },
        {
          "type": "inline_richtext",
          "id": "heading",
          "label": "Heading",
          "default": "Image heading"
        },
        {
          "type": "richtext",
          "id": "text",
          "label": "Text",
          "default": "<p>Add descriptive text for your image.</p>"
        },
        {
          "type": "checkbox",
          "id": "center_content",
          "label": "Center text and button",
          "default": false
        },
        {
          "type": "text",
          "id": "button_label",
          "label": "Button label"
        },
        {
          "type": "url",
          "id": "button_link",
          "label": "Button link"
        }
      ]
    },
    {
      "type": "video",
      "name": "Video",
      "settings": [
        {
          "type": "image_picker",
          "id": "cover_image",
          "label": "Cover image"
        },
        {
          "type": "video_url",
          "id": "video_url",
          "accept": ["youtube", "vimeo"],
          "default": "https://www.youtube.com/watch?v=_9VUPq3SxOc",
          "label": "Video URL",
          "placeholder": "Use a YouTube or Vimeo URL",
          "info": "Video will open in a popup window"
        },
        {
          "type": "text",
          "id": "description",
          "default": "A cool video",
          "label": "Video alt text",
          "info": "Describe the video for customers using screen readers"
        },
        {
          "type": "select",
          "id": "image_height",
          "label": "Video cover height",
          "options": [
            {
              "value": "adapt",
              "label": "Adapt to image ratio"
            },
            {
              "value": "small",
              "label": "Small (200px)"
            },
            {
              "value": "medium",
              "label": "Medium (300px)"
            },
            {
              "value": "large",
              "label": "Large (400px)"
            },
            {
              "value": "extra_large",
              "label": "Extra Large (500px)"
            }
          ],
          "default": "adapt",
          "info": "Control how the video cover image is displayed. Max height is always 800px."
        },
        {
          "type": "url",
          "id": "block_link",
          "label": "Block link",
          "info": "Make the entire block clickable (Note: Video modal will still work)"
        },
        {
          "type": "header",
          "content": "Content"
        },
        {
          "type": "inline_richtext",
          "id": "heading",
          "label": "Heading",
          "default": "Video heading"
        },
        {
          "type": "richtext",
          "id": "text",
          "label": "Text",
          "default": "<p>Add descriptive text for your video.</p>"
        },
        {
          "type": "checkbox",
          "id": "center_content",
          "label": "Center text and button",
          "default": false
        },
        {
          "type": "text",
          "id": "button_label",
          "label": "Button label"
        },
        {
          "type": "url",
          "id": "button_link",
          "label": "Button link"
        }
      ]
    }
  ],
  "max_blocks": 2,
  "presets": [
    {
      "name": "Win98 Media Duo",
      "blocks": [
        {
          "type": "image"
        },
        {
          "type": "video"
        }
      ]
    }
  ]
}
{% endschema %}