{% comment %}
  Win98 Cart Drawer - Complete Rebuild
  Building each component step by step for clean, maintainable code
{% endcomment %}

{{ 'component-cart-items.css' | asset_url | stylesheet_tag }}
{{ 'win98-cart-drawer-rebuild.css' | asset_url | stylesheet_tag }}

<script src="{{ 'cart.js' | asset_url }}" defer="defer"></script>

<style>
  .drawer {
    visibility: hidden;
  }
</style>

<cart-drawer class="drawer{% if cart == empty %} is-empty{% endif %}">
  <div id="CartDrawer" class="cart-drawer">
    <div id="CartDrawer-Overlay" class="cart-drawer__overlay"></div>
    
    <div class="drawer__inner win98-cart-container">
      
      <!-- COMPONENT 1: Window Frame & Title Bar -->
      <div class="win98-window">
        <!-- REBUILT TITLE BAR - Clean & Simple -->
        <div class="cart-titlebar">
          <div class="cart-titlebar-content">
            <span class="cart-icon">ðŸ›’</span>
            <span class="cart-title">{{ 'sections.cart.title' | t }}</span>
            {% unless cart == empty %}
              <span class="cart-count">({{ cart.item_count }})</span>
            {% endunless %}
            <button 
              class="cart-close-btn" 
              type="button"
              onclick="this.closest('cart-drawer').close()"
              aria-label="{{ 'accessibility.close' | t }}"
            >
              âœ•
            </button>
          </div>
        </div>
        
        <!-- COMPONENT 2: Window Content Area -->
        <div class="win98-content">
          {% if cart == empty %}
            <!-- EMPTY CART STATE -->
            <div class="empty-cart-state">
              <div class="empty-cart-icon">ðŸ›’</div>
              <h3 class="empty-cart-title">{{ 'sections.cart.empty' | t }}</h3>
              <p class="empty-cart-message">{{ 'sections.cart.empty_desc' | t }}</p>
              <a href="{{ routes.all_products_collection_url }}" class="win98-button continue-shopping-btn">
                {{ 'general.continue_shopping' | t }}
              </a>
            </div>
          {% else %}
            <!-- COMPONENT 3: CART ITEMS CONTAINER -->
            <div class="cart-items-container">
              <div class="cart-items-header">
                <span class="header-item">Item</span>
                <span class="header-quantity">Qty</span>
                <span class="header-price">Price</span>
              </div>
              
              <div class="cart-items-list">
                {% for item in cart.items %}
                  <!-- COMPONENT 4: Individual Cart Items will go here -->
                  <div class="cart-item">
                    <div class="item-image">
                      {% if item.image %}
                        {{ item.image | image_url: width: 64 | image_tag: loading: 'lazy', alt: item.product.title }}
                      {% else %}
                        <div class="no-image">ðŸ“¦</div>
                      {% endif %}
                    </div>
                    <div class="item-details">
                      <h4 class="item-title">{{ item.product.title }}</h4>
                      {% unless item.product.has_only_default_variant %}
                        <p class="item-variant">{{ item.variant.title }}</p>
                      {% endunless %}
                    </div>
                    <div class="item-quantity">
                      <div class="quantity-controls">
                        <button class="quantity-btn decrease" onclick="changeQuantity({{ item.index }}, {{ item.quantity | minus: 1 }})">-</button>
                        <input type="number" value="{{ item.quantity }}" min="0" class="quantity-input" onchange="changeQuantity({{ item.index }}, this.value)">
                        <button class="quantity-btn increase" onclick="changeQuantity({{ item.index }}, {{ item.quantity | plus: 1 }})">+</button>
                      </div>
                    </div>
                    <div class="item-price">
                      {{ item.final_line_price | money }}
                    </div>
                  </div>
                {% endfor %}
              </div>
            </div>
          {% endif %}
        </div>
      </div>
      
    </div>
  </div>
</cart-drawer>