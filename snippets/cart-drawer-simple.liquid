{% comment %}
  Simple Win98 Cart Drawer - Streamlined Structure
  
  Features:
  - Clean, minimal HTML structure
  - Essential Win98 styling only
  - Simplified JavaScript compatibility
  - Better performance and maintainability
{% endcomment %}

{{ 'component-cart-items.css' | asset_url | stylesheet_tag }}
{{ 'win98-cart-drawer-simple.css' | asset_url | stylesheet_tag }}

<script src="{{ 'cart.js' | asset_url }}" defer="defer"></script>

<style>
  .drawer {
    visibility: hidden;
  }
</style>

<cart-drawer class="drawer{% if cart == empty %} is-empty{% endif %}">
  <div id="CartDrawer" class="cart-drawer">
    <div id="CartDrawer-Overlay" class="cart-drawer__overlay"></div>
    
    <div class="drawer__inner win98-cart">
      
      <!-- Header -->
      <div class="win98-cart-header">
        <h2 class="win98-cart-title">
          üõí {{ 'sections.cart.title' | t }}
          {% unless cart == empty %}({{ cart.item_count }}){% endunless %}
        </h2>
        <button 
          class="drawer__close win98-close-btn" 
          type="button"
          onclick="this.closest('cart-drawer').close()"
          aria-label="{{ 'accessibility.close' | t }}"
        >
          ‚úï
        </button>
      </div>
      
      {% if cart == empty %}
        <!-- Empty State -->
        <div class="drawer__inner-empty win98-cart-empty">
          <div class="win98-empty-content">
            <p class="win98-empty-message">{{ 'sections.cart.empty' | t }}</p>
            <a href="{{ routes.all_products_collection_url }}" class="win98-btn">
              {{ 'general.continue_shopping' | t }}
            </a>
          </div>
        </div>
      {% else %}
        <!-- Cart Items -->
        <cart-drawer-items class="win98-cart-items">
          <div id="CartDrawer-LineItemStatus" class="visually-hidden" role="status">
            {{ 'accessibility.loading' | t }}
          </div>
          
          <form action="{{ routes.cart_url }}" id="CartDrawer-Form" method="post">
            <div class="win98-items-list" id="CartDrawer-CartItems">
              {%- for item in cart.items -%}
                <div class="win98-item" id="CartDrawer-Item-{{ item.index | plus: 1 }}">
                  
                  <!-- Product Image & Details -->
                  <div class="win98-item-main">
                    {% if item.image %}
                      <img 
                        src="{{ item.image | image_url: width: 60 }}" 
                        alt="{{ item.image.alt | escape }}"
                        class="win98-item-image"
                        width="60" height="60"
                      >
                    {% endif %}
                    
                    <div class="win98-item-details">
                      <a href="{{ item.url }}" class="win98-item-name">
                        {{ item.product.title | escape }}
                      </a>
                      
                      {%- if item.product.has_only_default_variant == false -%}
                        <div class="win98-item-variants">
                          {%- for option in item.options_with_values -%}
                            <span class="win98-variant">{{ option.name }}: {{ option.value }}</span>
                          {%- endfor -%}
                        </div>
                      {%- endif -%}
                      
                      <div class="win98-item-price">
                        {%- if item.original_price != item.final_price -%}
                          <span class="win98-price-sale">{{ item.final_price | money }}</span>
                          <span class="win98-price-compare">{{ item.original_price | money }}</span>
                        {%- else -%}
                          <span class="win98-price">{{ item.original_price | money }}</span>
                        {%- endif -%}
                      </div>
                    </div>
                  </div>
                  
                  <!-- Quantity & Total -->
                  <div class="win98-item-controls">
                    <quantity-input class="quantity">
                      <button class="win98-qty-btn" name="minus" type="button">-</button>
                      <input 
                        class="win98-qty-input"
                        type="number"
                        name="updates[]"
                        value="{{ item.quantity }}"
                        min="0"
                        id="Drawer-quantity-{{ item.index | plus: 1 }}"
                        data-index="{{ item.index | plus: 1 }}"
                      >
                      <button class="win98-qty-btn" name="plus" type="button">+</button>
                    </quantity-input>
                    
                    <div class="win98-item-total">
                      {%- if item.original_line_price != item.final_line_price -%}
                        <span class="win98-total-sale">{{ item.final_line_price | money }}</span>
                      {%- else -%}
                        <span class="win98-total">{{ item.original_line_price | money }}</span>
                      {%- endif -%}
                    </div>
                    
                    <cart-remove-button data-index="{{ item.index | plus: 1 }}">
                      <button type="button" class="win98-remove-btn" aria-label="Remove {{ item.title }}">
                        üóëÔ∏è
                      </button>
                    </cart-remove-button>
                  </div>
                </div>
              {%- endfor -%}
            </div>
          </form>
        </cart-drawer-items>
        
        <!-- Footer -->
        <div class="win98-cart-footer">
          <div class="win98-subtotal">
            <span class="win98-subtotal-label">Total</span>
            <span class="win98-subtotal-amount">{{ cart.total_price | money_with_currency }}</span>
          </div>
          
          <button 
            type="submit" 
            form="CartDrawer-Form"
            formaction="{{ routes.cart_url }}"
            class="win98-checkout-btn"
            {% if cart == empty %}disabled{% endif %}
          >
            {{ 'sections.cart.checkout' | t }}
          </button>
        </div>
      {% endif %}
    </div>
  </div>
</cart-drawer>